'use strict'

exports.__esModule = true
exports.default = exports.useThrottle = exports.useThrottleCallback = void 0

var _react = require('react')

var _requestTimeout = require('@essentials/request-timeout')

const useThrottleCallback = (fn, fps = 30, leading = false) => {
  const nextTimeout = (0, _react.useRef)(null),
    tailTimeout = (0, _react.useRef)(null),
    calledLeading = (0, _react.useRef)(false),
    wait = 1000 / fps // cleans up pending timeouts when the function changes

  function _ref() {
    if (nextTimeout.current !== null) {
      ;(0, _requestTimeout.clearRequestTimeout)(nextTimeout.current)
      nextTimeout.current = null
    }

    if (tailTimeout.current !== null) {
      ;(0, _requestTimeout.clearRequestTimeout)(tailTimeout.current)
      tailTimeout.current = null
    }

    calledLeading.current = false
  }

  ;(0, _react.useEffect)(() => _ref, [fn, fps])
  return (0, _react.useCallback)(
    function() {
      const this_ = this,
        args = arguments

      function _ref2() {
        nextTimeout.current = null
        tailTimeout.current === null && (calledLeading.current = false)
        fn.apply(this_, args)
      }

      function _ref3() {
        tailTimeout.current = null
        calledLeading.current = false
        nextTimeout.current === null && fn.apply(this_, args)
      }

      if (nextTimeout.current === null) {
        const next = _ref2

        if (leading === true && calledLeading.current === false) {
          // leading
          next()
          calledLeading.current = true
        } else {
          // head
          nextTimeout.current = (0, _requestTimeout.requestTimeout)(next, wait)
        }
      } else {
        // tail
        tailTimeout.current !== null &&
          (0, _requestTimeout.clearRequestTimeout)(tailTimeout.current)
        tailTimeout.current = (0, _requestTimeout.requestTimeout)(_ref3, wait)
      }
    },
    [fn, fps]
  )
}

exports.useThrottleCallback = useThrottleCallback

const useThrottle = (initialState, fps, leading) => {
  const [state, setState] = (0, _react.useState)(initialState)
  return [state, useThrottleCallback(setState, fps, leading)]
}

exports.useThrottle = useThrottle
var _default = useThrottle
exports.default = _default
